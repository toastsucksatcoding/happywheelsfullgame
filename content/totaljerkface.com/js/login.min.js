$(document).ready(function(){initValidateLogin();setLoginButtonState(true)});function loginUser(){var a=$("#loginForm");a.find(":input").each(function(){var b=$(this);b.val(b.val().trim())});if(a.valid()){postUserLogin(a)}}function loginOnEnterKey(a){if(a&&a.keyCode==13){loginUser()}}function logOutUser(){var a=$.post(LOGIN_POST_PATH,{action:"logout"});a.fail(function(){alert("There was an unexpected error logging out.")});a.done(function(){window.location.reload(true)})}function postUserLogin(b){setLoginButtonState(false);var a=$.post(LOGIN_POST_PATH,b.serialize());a.fail(function(){showLoginErrorMsg("Login Failed. System Error. Please try again later.")});a.done(function(c){var d=c.split(":");var f=d[0];var e=d[1];if(f=="success"&&e=="true"){window.location.reload(true)}else{if(f=="failure"&&e=="userpass"){showLoginErrorMsg("Login failed. No matching email and password.")}else{if(f=="lockout"){e=(e>1)?e+" minutes.":e+" minute.";showLoginErrorMsg("Too many failed logins. Please wait "+e)}else{alert("System Error. Please try again later.")}}}})}function initValidateLogin(){$("#loginForm").validate({onkeyup:false,invalidHandler:function(c,b){if(b.numberOfInvalids()){var a=b.errorList[0].message;showLoginErrorMsg(a)}},errorPlacement:function(a){},rules:{login_user_email:{required:true,minlength:6,email:true},login_user_pass:{required:true}},messages:{login_user_email:{required:"Please enter an email address.",minlength:"Enter an email at least six characters."},login_user_pass:{required:"Please enter your password."}}})}function setLoginButtonState(a){var b=$("#login_btn");if(a){b.prop("disabled",false);b.fadeTo(1,1)}else{b.prop("disabled",true);b.fadeTo(1,0.5)}}function showLoginErrorMsg(c){var b=400;var a=1700;$("#login_error_msg").html(c).fadeOut(0).fadeIn(b,function(){$("#problems_button").delay(a).slideDown(b);$("#login_error_msg").delay(a).fadeOut(b,function(){setLoginButtonState(true)})})}var LOGIN_POST_PATH="/user.hw";